<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Seguridad Inform치tica</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/03/24/audio_1c57223659.mp3?filename=ambient-piano-10657.mp3" type="audio/mp3">
    </audio>
    <audio id="correct-sound">
        <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_bb630cc098.mp3?filename=success-1-6297.mp3" type="audio/mp3">
    </audio>
    <audio id="fail-sound">
        <source src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_02d9b2767e.mp3?filename=error-2-126514.mp3" type="audio/mp3">
    </audio>
    <audio id="click-sound">
        <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_c8c8a73467.mp3?filename=click-button-140881.mp3" type="audio/mp3">
    </audio>

    <div id="app-loader">
        <div class="spinner"></div>
        <p>Cargando Simulador...</p>
    </div>

    <div id="combo-display" class="hidden"></div>

    <header>
        <div class="logo">
            <i class="fa-solid fa-shield-halved" style="color: var(--primary); font-size: 1.5rem;"></i>
            <h1>Simulador <span style="font-weight:400; color:#555;">Seguridad</span></h1>
        </div>
        
        <div id="header-user-info" class="header-user-info hidden">
            <span class="header-username-text" id="header-username">Usuario</span>
            <img src="" id="header-photo" class="header-profile-pic" alt="Foto perfil">
        </div>

        <div class="header-controls">
            <button id="btn-admin-settings" class="btn-icon hidden" title="Admin Panel">
                <i class="fa-solid fa-cog"></i>
            </button>
            <div class="volume-control-box">
                <i id="btn-mute" class="fa-solid fa-volume-high" style="cursor: pointer; color:#555;"></i>
                <input type="range" id="volume-slider" min="0" max="1" step="0.1" value="0.5">
            </div>
            <button id="btn-logout" class="btn-secondary hidden" style="width:auto; padding: 6px 15px; font-size:0.8rem;">Salir</button>
        </div>
    </header>

    <div id="auth-screen" class="container">
        <h2 class="auth-title">Bienvenido</h2>
        <p class="auth-subtitle">Inicia sesi칩n con tu cuenta institucional</p>
        <button id="btn-google" class="btn-google-style">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="Google logo">
            Continuar con Google
        </button>
    </div>

    <div id="setup-screen" class="container hidden">
        <div class="profile-row">
            <img id="user-google-photo" class="google-profile-pic hidden" src="" alt="Foto Google">
            <div>
                <h2 class="auth-title" style="font-size: 1.4rem; margin:0;">Hola, <span id="user-display">Estudiante</span></h2>
                <div class="verified-badge">
                    <i class="fa-solid fa-check-circle"></i> Dispositivo verificado
                </div>
            </div>
        </div>

        <div class="control-group" style="margin-top: 20px;">
            <label>Materia</label>
            <select disabled>
                <option>Seguridad Inform치tica</option>
            </select>
        </div>

        <div class="control-group">
            <label>Modo</label>
            <select id="mode-select">
                <option value="individual">游녻 Examen Individual</option>
                <option value="multiplayer">丘덢잺 Batalla Multiusuarios</option>
                <option value="study">游닄 Modo Estudio (Guardar progreso)</option>
            </select>
        </div>
        
        <div id="alias-input-group" class="control-group hidden">
            <label>Alias para Batalla</label>
            <input type="text" id="alias-input" placeholder="Tu Apodo de Guerrero" maxlength="15" style="text-align:center; font-weight:bold; color:var(--primary);">
            <p style="font-size:0.75rem; color:#666;">Tu alias se usar치 para el ranking temporal.</p>
        </div>

        <div class="control-group">
            <label>Tiempo</label>
            <select id="time-select">
                <option value="30">30 minutos</option>
                <option value="60">60 minutos</option>
                <option value="infinity">Sin l칤mite de tiempo</option>
            </select>
        </div>

        <button id="btn-start" class="btn-primary">Empezar</button>
    </div>

    <div id="avatar-screen" class="container hidden">
        <h2 class="auth-title">Elige tu Personaje</h2>
        <p class="auth-subtitle">Tu identidad para esta batalla</p>
        
        <div class="control-group" style="text-align: center;">
            <input type="text" id="player-nickname" readonly 
                   style="text-align:center; background:#e8f0fe; border:2px solid var(--primary); font-weight:bold; font-size: 1.2rem; color: var(--primary);">
        </div>

        <div id="avatar-grid-container" class="avatar-grid">
            <!-- Los avatares se generan din치micamente -->
        </div>

        <button id="btn-confirm-identity" class="btn-primary" style="margin-top: 20px;">
            Confirmar y Buscar Sala <i class="fa-solid fa-search"></i>
        </button>
        <button id="back-to-setup" class="btn-secondary" style="margin-top: 10px;">
            Volver al Men칰
        </button>
    </div>

    <div id="rooms-screen" class="container hidden">
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <button id="back-to-avatar" class="btn-icon">
                <i class="fa-solid fa-arrow-left"></i>
            </button>
            <h2 class="auth-title" style="margin:0;">Zonas de Guerra</h2>
        </div>
        <p class="auth-subtitle">칔nete a una sala activa o crea una nueva</p>

        <div id="rooms-container" class="rooms-grid">
            <!-- Las salas se generan din치micamente -->
            <p style="text-align:center; color:#666;">Cargando salas...</p>
        </div>
    </div>

    <div id="lobby-screen" class="container hidden">
        <h2 class="auth-title">Sala: <span id="lobby-room-name">...</span></h2>
        <p class="auth-subtitle">Esperando guerreros...</p>

        <div id="lobby-player-list" class="lobby-list">
            <!-- Lista de jugadores se genera din치micamente -->
        </div>

        <button id="btn-lobby-ready" class="btn-primary">
            춰ESTOY LISTO! 丘덢잺
        </button>
        
        <!-- Bot칩n "Salir de sala" se agregar치 din치micamente aqu칤 -->
    </div>

    <div id="quiz-screen" class="container hidden">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
            <span id="progress-display" style="font-weight: 600; color: #666;">Pregunta 1 de 20</span>
            <span id="timer-display" style="font-weight: 700; color: var(--danger);">--:--</span>
        </div>

        <div class="question-box">
            <h2 id="question-text">Cargando pregunta...</h2>
        </div>

        <div id="options-container" class="options-box">
            <!-- Las opciones se generan din치micamente -->
        </div>

        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button id="btn-quit-quiz" class="btn-secondary hidden" style="width: auto;">
                <i class="fa-solid fa-flag"></i> Rendirse
            </button>
            <button id="btn-exit-quiz" class="btn-secondary hidden" style="width: auto;">
                Volver al Men칰
            </button> 
            <button id="btn-next-question" class="btn-primary hidden">
                Siguiente <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <div id="result-screen" class="container hidden" style="text-align: center;">
        <h2 class="auth-title">Finalizado</h2>
        <h1 id="score-final" style="font-size: 3rem; margin: 10px 0; color: var(--primary);">0 / 0</h1>
        <p id="custom-msg" class="auth-subtitle">춰Bien hecho!</p>

        <img id="final-avatar-display" class="final-avatar hidden" src="" alt="Avatar jugador">

        <div id="room-results-box" class="hidden">
            <h3>游끥 Podio de Batalla 游끥</h3>
            <div id="podium-container" class="podium-container"></div>
        </div>

        <button id="btn-review" class="btn-secondary" style="margin-bottom: 10px;">
            Revisar Respuestas
        </button>
        <button id="btn-inicio-final" class="btn-primary">
            Volver al Inicio
        </button>
    </div>

    <div id="resume-modal" class="modal-overlay hidden">
        <div class="modal-card">
            <h2 class="auth-title">Sesi칩n Encontrada</h2>
            <p id="resume-text">쮺ontinuar donde lo dejaste?</p>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button id="btn-resume-no" class="btn-secondary">Empezar de cero</button>
                <button id="btn-resume-yes" class="btn-primary">Continuar</button>
            </div>
        </div>
    </div>

    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-card" style="max-width: 600px; text-align: left;">
            <button id="close-admin" class="close-btn">&times;</button>
            <h2 class="auth-title">Panel de Administraci칩n</h2>
            
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button id="btn-admin-clean-rooms" class="btn-secondary" style="font-size:0.8rem;">
                    Limpiar Salas
                </button>
            </div>

            <hr>
            <h4>Agregar Usuario</h4>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <input type="email" id="admin-new-email" placeholder="correo@unemi.edu.ec">
            </div>
            <div style="margin-bottom:10px; font-size:0.9rem;">
                <label style="display:inline;">
                    <input type="radio" name="device-limit" value="1" checked> 1 Disp.
                </label>
                <label style="display:inline; margin-left:15px;">
                    <input type="radio" name="device-limit" value="2"> 2 Disp.
                </label>
            </div>
            <button id="btn-admin-add-user" class="btn-primary" style="padding:8px;">
                Autorizar
            </button>

            <hr>
            <h4>Resetear Dispositivo (Desbloqueo)</h4>
            <div style="display:flex; gap:5px;">
                <input type="email" id="admin-reset-email" placeholder="Usuario bloqueado">
                <button id="btn-admin-reset-user" class="btn-secondary" style="width:auto;">
                    Reset
                </button>
            </div>

            <hr>
            <h4>Usuarios Autorizados</h4>
            <div id="admin-users-list" style="max-height: 200px; overflow-y: auto; border:1px solid #eee; border-radius:8px;">
                <!-- Lista de usuarios se genera din치micamente -->
            </div>
        </div>
    </div>

    <!-- Elemento para serpentinas -->
    <div id="confetti-wrapper"></div>
    
    <script type="module" src="script.js"></script>

</body>
</html>
